import {
  ObjectModelCodec,
  decodeMsgpack as rawDecodeMsgpack,
  encodeMsgpack as rawEncodeMsgpack,
  stringifyJson,
  type ObjectModelMetadata,
} from '@algorandfoundation/algokit-common'

export function encodeJson<T extends Record<string, unknown>>(value: T, meta: ObjectModelMetadata<T>, space?: string | number): string {
  const wire = new ObjectModelCodec(meta).encode(value, 'json');
  return stringifyJson(wire, undefined, space);
}
export function encodeMsgpack<T extends Record<string, unknown>>(value: T, meta: ObjectModelMetadata<T>): Uint8Array {
  const wire = new ObjectModelCodec(meta).encode(value, 'msgpack')
  return rawEncodeMsgpack(wire)
}
export function decodeJson<T extends Record<string, unknown>>(value: Record<string, unknown>, meta: ObjectModelMetadata<T>): T {
  return new ObjectModelCodec<T>(meta).decode(value, 'json')
}
export function decodeMsgpack<T extends Record<string, unknown>>(value: Uint8Array, meta: ObjectModelMetadata<T>): T {
  const wire = rawDecodeMsgpack(value)
  return new ObjectModelCodec<T>(meta).decode(wire, 'msgpack')
}
